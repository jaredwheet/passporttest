<!DOCTYPE html>
<html lang="en">

<head>
  <title>Baby Tracker </title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/lumen/bootstrap.min.css">
  <link href="stylesheets/style.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
</head>

<body>
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="/logout">
          Logout
        </a>
        <h2>Welcome <span class="member-name"></span></h2>
      </div>
    </div>
  </nav>


  <div class="jumbotron jumbotron-fluid">
    <div class="container">
      <h1 class="display-4">Baby Tracker</h1>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      Baby last ate....
    </div>
    <a href="/eat">Eating History</a>

  </div>

  <div class="card">
    <div class="card-header">
      Baby last slept
    </div>
    <a href="/sleep">Sleeping History</a>

  </div>

  <div class="card">
    <div class="card-header">
      Baby vitals
    </div>
    <a href="/vitals">Vitals History</a>

  </div>

  <div class="card">
    <div id="usernameInput" class="card-header">
      Your username is:
    </div>


  </div>

  <button type="button" id="feed" class="btn btn-dark submit">Start Feeding</button>
  <a href="/api/eatingData">Eating API</a>
  <!-- <button type="button" id="endFeed" class="btn btn-dark submit">End Feeding</button> -->
  <button type="button" id="sleep" class="btn btn-dark submit">Start Sleep</button>
  <a href="/api/sleepData">Sleep API</a>
  <!-- <button type="button" id="endSleep" class="btn btn-dark submit">End Sleep</button> -->

  <div class="input-group mb-3">
    <div class="input-group-prepend">
      <span class="input-group-text" id="inputGroup-sizing-default">Enter your baby's height</span>
    </div>
    <input type="text" class="form-control" id="height" aria-label="Sizing example input"
      aria-describedby="inputGroup-sizing-default">
  </div>

  <div class="input-group mb-3">
    <div class="input-group-prepend">
      <span class="input-group-text" id="inputGroup-sizing-default">Enter your baby's weight</span>
    </div>
    <input type="text" class="form-control" id="weight" aria-label="Sizing example input"
      aria-describedby="inputGroup-sizing-default">
  </div>
  <button type="button" id="vitalsSubmit" class="btn btn-dark submit">Submit Vitals</button>
  <a href="/api/vitalsData">Vitals API</a>


  <footer>

  </footer>

  <!-- BELOW CODE IS CRITICAL. IT HANDLES HOW FORM DATA IS SENT TO OUR SERVER -->
  <script type="text/javascript">
    $(document).ready(function () {
      // This file just does a GET request to figure out which user is logged in
      // and updates the HTML on the page
      $.get("/api/user_data").then(function (data) {
        $(".member-name").text(data.username);
        var username = data.username
        $("#feed").on("click", function (event) {
          event.preventDefault();

          var feedingStartTimestamp = moment().format('LLLL')
          var a = moment()

          // This is used to change button text, to indicated if feeding has been started.
          var $this = $(this);
          $this.toggleClass('feedingStarted');

          if ($this.hasClass('feedingStarted')) {
            $this.text('End Feeding');
            $this.on("click", function (event) {
              var feedingEndTimestamp = moment().format('LLLL')
              var b = moment()
              var duration = b.diff(a, 'minutes')            
              var newEatingTimestamp = {
                timeStart: feedingStartTimestamp,
                timeEnd: feedingEndTimestamp,
                duration: duration,
                username: username,
              };
              $.post("/api/eatingData", newEatingTimestamp,
                function (data) {
                  console.log(data)
                });
              location.reload();
            });

          }
          else {
            $this.text('Start Feeding')


          }
        });
        $("#sleep").on("click", function (event) {
          event.preventDefault();
          var sleepingStartTimestamp = moment().format('LLLL')
          //Need the current time to remain a moment object for duration calculation
          var a = moment()
          // This is used to change button text, to indicated if feeding has been started.
          var $this = $(this);
          $this.toggleClass('sleepingStarted');

          if ($this.hasClass('sleepingStarted')) {
            $this.text('End Sleeping');
            $this.on("click", function (event) {
              var sleepingEndTimestamp = moment().format('LLLL')    
              // need the end sleep time to remain a moment object for the duration calculation                      
              var b = moment()
              var duration = b.diff(a, 'minutes')
              console.log(duration)

              var newSleepTimestamp = {
                timeStart: sleepingStartTimestamp,
                timeEnd: sleepingEndTimestamp,
                duration: duration,
                username: username,
              };

              $.post("/api/sleepData", newSleepTimestamp,
                function (data) {
                  console.log(data)
                });
              location.reload();
            });

          }
          else {
            $this.text('Start Sleeping')


          }
        });
        $("#vitalsSubmit").on("click", function (event) {
          event.preventDefault();
          currentTime = moment().format('LLLL')

          var newVitals = {
            timestamp: currentTime,
            height: parseFloat($("#height").val().trim()),
            weight: parseFloat($("#weight").val().trim()),
            username: username
          };
          console.log("submitting vitals")
          console.log(newVitals)

          $.post("/api/vitalsData", newVitals,
            function (data) {
              console.log(data)
            });
          $("#height").val("");
          $("#weight").val("");
          alert("Baby Vitals has been submitted and saved!")
        })
      });
    });
    // In this code below we create the Front-end JavaScript which "POSTS" our form data to our express server.
    // In essence, when the user hits submit, jQuery grabs all of the fields then sends a post request to our api
    // Our api recognizes the route (/api/tables)... and then runs the associated code (found in api-routes.js).
    // In this case the associated code "saves" the data to the table-data.js file or waitinglist-data.js file





  </script>



  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script type="text/javascript" src="js/members.js"></script>

</body>

</html>